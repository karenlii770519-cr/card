<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŒ‡è¦å¦³ Just ForYou | ç·šä¸Šé ç´„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root { --brand-wine: #8F2C2F; --brand-pink: #D86B76; --bg-gray: #F3F4F6; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--bg-gray); }
        .selected-card { border-color: #ea5548 !important; background-color: white !important; transform: scale(1.02); }
        .btn-disabled { background-color: #d1d5db !important; color: #9ca3af !important; cursor: not-allowed !important; pointer-events: none; }
        .hidden { display: none !important; }
    </style>
</head>
<body class="pb-12">

    <div id="loading" class="fixed inset-0 bg-white z-50 flex flex-col items-center justify-center">
        <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-[#8F2C2F] mb-4"></div>
        <p class="text-[#8F2C2F] font-bold"> è¼‰å…¥ä¸­è«‹è€å¿ƒç­‰å¾…...</p>
    </div>

    <div id="app" class="max-w-md mx-auto min-h-screen relative hidden">
        
        <header class="p-6 flex justify-between items-center bg-white shadow-sm mb-4 sticky top-0 z-10">
            <div><h1 class="text-xl font-bold text-gray-700">æŒ‡è¦å¦³ <span class="text-[#ea5548] text-sm block">Just ForYou Nail salon</span></h1></div>
            <div class="flex items-center gap-3">
                <button onclick="showMyBookings()" class="text-xs bg-gray-100 px-3 py-2 rounded-full font-bold text-gray-600 hover:bg-gray-200">ğŸ“‹ æˆ‘çš„é ç´„</button>
                <img id="userImg" src="https://via.placeholder.com/40" class="w-8 h-8 rounded-full border border-gray-200">
            </div>
        </header>

        <div id="mainView">
            <div class="px-6 mb-6">
                <div class="w-full bg-gray-200 h-1.5 rounded-full overflow-hidden">
                    <div id="progressBar" class="h-full bg-[#ea5548] transition-all duration-500" style="width: 20%"></div>
                </div>
            </div>

            <main class="px-4">
                <div id="step1" class="step-content">
                    <h2 class="text-lg font-bold text-gray-700 mb-4 border-l-4 border-[#8F2C2F] pl-3">é¸æ“‡é …ç›®</h2>
                    <div id="categoryList" class="grid grid-cols-2 gap-3 pb-8"></div>
                </div>

                <div id="step2" class="step-content hidden">
                    <h2 class="text-lg font-bold text-gray-700 mb-4 border-l-4 border-[#8F2C2F] pl-3">é¸æ“‡æ¬¾å¼</h2>
                    <div id="serviceList" class="space-y-3 pb-8"></div>
                    <button onclick="changeStep(1)" class="w-full mt-4 py-3 bg-white text-gray-400 font-bold border rounded-xl">å›ä¸Šä¸€æ­¥</button>
                </div>

                <div id="step3" class="step-content hidden">
                    <h2 class="text-lg font-bold text-gray-700 mb-4 border-l-4 border-[#8F2C2F] pl-3">é¸æ“‡è€å¸«</h2>
                    <div id="stylistList" class="space-y-3"></div>
                    <div class="flex gap-3 mt-6">
                        <button onclick="changeStep(2)" class="w-1/3 py-3 bg-white text-gray-400 font-bold border rounded-xl">ä¸Šä¸€æ­¥</button>
                        <button onclick="changeStep(4)" class="flex-1 py-3 bg-[#ea5548] text-white font-bold rounded-xl shadow-lg">ä¸‹ä¸€æ­¥</button>
                    </div>
                </div>

                <div id="step4" class="step-content hidden">
                    <h2 class="text-lg font-bold text-gray-700 mb-4 border-l-4 border-[#8F2C2F] pl-3">é ç´„æ™‚é–“</h2>
                    <div class="bg-white p-4 rounded-2xl shadow-sm mb-4">
                        <label class="block text-xs font-bold text-gray-400 mb-2">æ—¥æœŸ</label>
                        <input type="date" id="dateInput" class="w-full bg-gray-50 p-3 rounded-xl font-bold text-gray-700 outline-none border focus:border-[#ea5548]">
                    </div>
                    <div class="bg-white p-4 rounded-2xl shadow-sm mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <label class="block text-xs font-bold text-gray-400">æ™‚æ®µ <span id="durationHint" class="text-[#ea5548]"></span></label>
                            <span id="timeLoading" class="text-xs text-[#ea5548] font-bold hidden">æŸ¥è©¢ä¸­...</span>
                        </div>
                        <div id="timeSlots" class="grid grid-cols-3 gap-2"></div>
                    </div>
                    <div class="bg-white p-4 rounded-2xl shadow-sm border border-[#ea5548]/20">
                        <label class="block text-xs font-bold text-gray-400 mb-2">é›»è©±</label>
                        <input type="tel" id="userPhone" placeholder="09xx..." class="w-full bg-gray-50 p-3 rounded-xl font-bold text-gray-700 outline-none border">
                    </div>
                    <div class="flex gap-3 mt-6">
                        <button onclick="changeStep(3)" class="w-1/3 py-3 bg-white text-gray-400 font-bold border rounded-xl">ä¸Šä¸€æ­¥</button>
                        <button onclick="validateAndNext()" class="flex-1 py-3 bg-[#ea5548] text-white font-bold rounded-xl shadow-lg">ä¸‹ä¸€æ­¥</button>
                    </div>
                </div>

                <div id="step5" class="step-content hidden">
                    <h2 class="text-lg font-bold text-gray-700 mb-4 border-l-4 border-[#8F2C2F] pl-3">ç¢ºèªè³‡è¨Š</h2>
                    <div class="bg-white p-6 rounded-2xl shadow-sm space-y-4 text-sm">
                        <div class="flex justify-between border-b pb-2"><span class="text-gray-400">é ç´„äºº</span><span id="confirmName" class="font-bold"></span></div>
                        <div class="flex justify-between border-b pb-2"><span class="text-gray-400">è€å¸«</span><span id="confirmStylist" class="font-bold"></span></div>
                        <div class="flex justify-between border-b pb-2"><span class="text-gray-400">é …ç›®</span><span id="confirmService" class="font-bold"></span></div>
                        <div class="flex justify-between border-b pb-2"><span class="text-gray-400">æ™‚é•·</span><span id="confirmDuration" class="font-bold text-[#8F2C2F]"></span></div>
                        <div class="flex justify-between"><span class="text-gray-400">æ™‚é–“</span><span id="confirmDateTime" class="font-bold text-[#ea5548]"></span></div>
                    </div>
                    <button onclick="submitBooking()" class="w-full mt-6 py-4 bg-[#ea5548] text-white font-bold rounded-2xl shadow-xl">ç¢ºèªé€å‡º</button>
                    <button onclick="changeStep(4)" class="w-full mt-3 py-3 text-gray-400 font-bold">è¿”å›ä¿®æ”¹</button>
                </div>

                <div id="stepSuccess" class="step-content hidden text-center pt-10">
                    <h2 class="text-2xl font-bold text-gray-700">é ç´„æˆåŠŸï¼</h2>
                    <button onclick="liff.closeWindow()" class="mt-8 px-8 py-3 bg-gray-800 text-white rounded-xl font-bold">é—œé–‰</button>
                </div>
            </main>
        </div>

        <div id="myBookingView" class="hidden px-4">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-bold text-gray-700 border-l-4 border-[#8F2C2F] pl-3">æˆ‘çš„é ç´„ç´€éŒ„</h2>
                <button onclick="closeMyBookings()" class="text-sm text-gray-500 font-bold px-3 py-1 border rounded-lg">é—œé–‰</button>
            </div>
            <div id="myBookingList" class="space-y-3 pb-8">
                <p class="text-center text-gray-400 mt-10">è¼‰å…¥ä¸­...</p>
            </div>
        </div>

    </div>

    <script>
        const LIFF_ID = "2008649114-uMkSDYgW"; 
        // âš ï¸ è«‹å¡«å…¥æ–°éƒ¨ç½²çš„ç¶²å€ âš ï¸
        const GAS_URL = "https://script.google.com/macros/s/AKfycbzQN8MHKglutmDGOOlcgDVbCswoYJR3hzfDBaiIMSYcisShfOehiE8TTTSqedds_2g/exec";

        const SHOP_CONFIG = { closedWeekday: 3, holidays: ["2026-01-01"], stylistLeaves: {'s1':[],'s2':[],'s3':[]} };
        const CATEGORIES = [ {id:'hand',name:'æ‰‹éƒ¨å…‰ç™‚',icon:'ğŸ’…'}, {id:'foot',name:'è¶³éƒ¨å…‰ç™‚',icon:'ğŸ¦¶'}, {id:'remove',name:'å¸ç”²',icon:'âœ¨'}, {id:'care',name:'ä¿é¤Š',icon:'ğŸŒ¿'} ];
        
        const SERVICES = [
            { category: 'hand', id: 'h1', name: 'ã€æ‰‹éƒ¨ã€‘å–®è‰²/è·³è‰²', price: 500, time: 60 },
            { category: 'hand', id: 'h2', name: 'ã€æ‰‹éƒ¨ã€‘è²“çœ¼', price: 600, time: 90 }, 
            { category: 'hand', id: 'h3', name: 'ã€æ‰‹éƒ¨ã€‘ç›¸ç°¿ $600 æ¬¾', price: 600, time: 90 },
            { category: 'hand', id: 'h4', name: 'ã€æ‰‹éƒ¨ã€‘ç›¸ç°¿ $700 æ¬¾', price: 700, time: 100 },
            { category: 'hand', id: 'h5', name: 'ã€æ‰‹éƒ¨ã€‘æšˆæŸ“ã€äº®ç²‰ç­‰', price: 700, time: 90 },
            { category: 'hand', id: 'h6', name: 'ã€æ‰‹éƒ¨ã€‘æ³•å¼', price: 800, time: 120 }, 
            { category: 'hand', id: 'h7', name: 'ã€æ‰‹éƒ¨ã€‘è‡ªå¸¶åœ–', price: 'ä¾å ±åƒ¹', time: 150 }, 
            { category: 'hand', id: 'c2', name: 'ã€å»¶ç”²ã€‘ç”²ç‰‡å»¶ç”² (10æŒ‡)', price: 1000, time: 60 }, 
            { category: 'hand', id: 'c3', name: 'ã€å»¶ç”²ã€‘ç”²ç‰‡å»¶ç”² (5æŒ‡å…§)', price: 500, time: 30 },
            { category: 'hand', id: 'm3', name: 'ã€æ‰‹è¶³ã€‘åŒæ™‚å…‰ç™‚', price: 1000, time: 120 }, 
            { category: 'foot', id: 'f1', name: 'ã€è¶³éƒ¨ã€‘å–®è‰²/è·³è‰²', price: 600, time: 60 },
            { category: 'foot', id: 'f2', name: 'ã€è¶³éƒ¨ã€‘è²“çœ¼', price: 600, time: 70 },
            { category: 'foot', id: 'f3', name: 'ã€è¶³éƒ¨ã€‘ç›¸ç°¿ $600 æ¬¾', price: 600, time: 70 },
            { category: 'foot', id: 'f4', name: 'ã€è¶³éƒ¨ã€‘ç›¸ç°¿ $700 æ¬¾', price: 700, time: 80 },
            { category: 'foot', id: 'f5', name: 'ã€è¶³éƒ¨ã€‘è‡ªå¸¶åœ–', price: 'ä¾å ±åƒ¹', time: 120 },
            { category: 'remove', id: 'r1', name: 'ã€å¸ç”²ã€‘æ‰‹/è¶³å–®å¸ç”²', price: 200, time: 30 },
            { category: 'remove', id: 'r2', name: 'ã€å¸ç”²ã€‘å»¶ç”²å¸ç”²', price: 400, time: 60 },
            { category: 'remove', id: 'm1', name: 'ã€çµ„åˆã€‘æ‰‹éƒ¨å¸ç”²+çºŒä½œ', price: 'ä¾æ¬¾å¼', time: 90 },
            { category: 'remove', id: 'm2', name: 'ã€çµ„åˆã€‘è¶³éƒ¨å¸ç”²+çºŒä½œ', price: 'ä¾æ¬¾å¼', time: 90 },
            { category: 'remove', id: 'm4', name: 'ã€çµ„åˆã€‘æ‰‹/è¶³å–®è‰²å…‰ç™‚+ä¿é¤Š', price: 1100, time: 90 },
            { category: 'care', id: 'c1', name: 'ã€ä¿é¤Šã€‘æ‰‹éƒ¨ä¿é¤Š', price: 600, time: 45 },
            { category: 'care', id: 'c4', name: 'ã€ä¿é¤Šã€‘è¶³éƒ¨ä¿®é¤Š', price: 'ç¾å ´å ±åƒ¹', time: 30 }
        ];

        const STYLISTS = [ 
            {id:'any',name:'ä¸æŒ‡å®šè¨­è¨ˆå¸«',img:''}, 
            {id:'s1',name:'è™¹',img:'https://via.placeholder.com/40'}, 
            {id:'s2',name:'æ•¬',img:'https://via.placeholder.com/40'}, 
            {id:'s3',name:'èŠ®ç¶º',img:'https://via.placeholder.com/40'} 
        ];

        let currentData = { category:null, service:null, stylist:STYLISTS[0], date:'', time:null, durationSlots: 1, phone:'', userId:'', userImg:'' };
        let bookedTimes = []; 

       window.onload = async function() {
            try {
                // ğŸš¨ æ¸¬è©¦ 2ï¼šé–‹å§‹åˆå§‹åŒ–
                alert("æ­¥é©Ÿ 1: æº–å‚™åˆå§‹åŒ– LIFF (" + LIFF_ID + ")");
                
                await liff.init({ liffId: LIFF_ID });
                
                // ğŸš¨ æ¸¬è©¦ 3ï¼šåˆå§‹åŒ–æˆåŠŸ
                alert("æ­¥é©Ÿ 2: LIFF åˆå§‹åŒ–æˆåŠŸï¼");

                if (!liff.isLoggedIn()) { 
                    alert("æ­¥é©Ÿ 3: å°šæœªç™»å…¥ï¼Œè½‰è·³ç™»å…¥...");
                    liff.login(); 
                    return; 
                }

                const profile = await liff.getProfile();
                document.getElementById('userName').innerText = profile.displayName;
                currentData.userId = profile.userId;
                
                // æ¸²æŸ“ç•«é¢
                renderCategories(); 
                renderStylists(); 
                // renderTimeSlots(); // å…ˆè¨»è§£æ‰ï¼Œæ€•é€™è£¡å ±éŒ¯

                // ğŸš¨ æ¸¬è©¦ 4ï¼šæº–å‚™é—œé–‰ Loading
                alert("æ­¥é©Ÿ 4: æº–å‚™é¡¯ç¤ºç•«é¢...");

                document.getElementById('loading').classList.add('hidden');
                document.getElementById('app').classList.remove('hidden');

            } catch (err) {
                // ğŸš¨ æŠ“åˆ°å…‡æ‰‹äº†ï¼
                alert("âŒ ç™¼ç”ŸéŒ¯èª¤ï¼š\n" + err);
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('app').classList.remove('hidden');
            }
        };

        // ç°¡å–®çš„æ¸²æŸ“å‡½å¼
        function renderCategories() { document.getElementById('categoryList').innerHTML = CATEGORIES.map(c => `<div class="p-4 border text-center">${c.name}</div>`).join(''); }
        function renderStylists() { document.getElementById('stylistList').innerHTML = STYLISTS.map(s => `<div class="p-3 border">${s.name}</div>`).join(''); }

    </script>
</body>
</html>
